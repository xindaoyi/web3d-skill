<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebGL 特殊变量准确对应关系</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            line-height: 1.6;
            margin: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .correspondence-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .correspondence-table th,
        .correspondence-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }

        .correspondence-table th {
            background-color: #3498db;
            color: white;
        }

        .direct {
            background-color: #e8f5e8;
        }

        .indirect {
            background-color: #fff8e1;
        }

        .generated {
            background-color: #e3f2fd;
        }

        .code-example {
            background-color: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            font-family: 'Courier New', monospace;
            margin: 15px 0;
            overflow-x: auto;
        }

        .correction-note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 20px 0;
        }

        .important {
            background: #ffebee;
            border-left: 4px solid #f44336;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>WebGL 特殊变量准确对应关系</h1>

        <div class="important">
            <h2>感谢您的纠正！</h2>
            <p>您说得对，<code>gl_PointCoord</code> 并不是独立生成的，而是由 <code>gl_PointSize</code> 直接决定的。</p>
        </div>

        <h2>完全准确的特殊变量对应关系表</h2>

        <table class="correspondence-table">
            <thead>
                <tr>
                    <th>顶点着色器特殊输出变量</th>
                    <th>关系类型</th>
                    <th>片元着色器特殊输入变量</th>
                    <th>说明</th>
                </tr>
            </thead>
            <tbody>
                <tr class="direct">
                    <td><code>gl_Position</code></td>
                    <td>直接影响</td>
                    <td>（影响片元生成）</td>
                    <td>决定顶点在屏幕上的位置，影响哪些像素生成片元</td>
                </tr>
                <tr class="direct">
                    <td><code>gl_PointSize</code></td>
                    <td>直接决定</td>
                    <td><code>gl_PointCoord</code></td>
                    <td>点大小直接决定点精灵内坐标生成</td>
                </tr>
                <tr class="indirect">
                    <td>varying 输出<br>
                        (<code>gl_FrontColor</code>等)
                    </td>
                    <td>插值传递</td>
                    <td>varying 输入<br>
                        (<code>gl_Color</code>等)
                    </td>
                    <td>顶点数据在图元内插值后传递给片元着色器</td>
                </tr>
                <tr class="generated">
                    <td>（无直接对应）</td>
                    <td>管线生成</td>
                    <td><code>gl_FragCoord</code></td>
                    <td>渲染管线根据图元位置自动生成片元坐标</td>
                </tr>
                <tr class="generated">
                    <td>（基于<code>gl_Position</code>）</td>
                    <td>计算生成</td>
                    <td><code>gl_FrontFacing</code></td>
                    <td>渲染管线根据顶点顺序和位置判断面朝向</td>
                </tr>
            </tbody>
        </table>

        <h2>详细工作机制</h2>

        <h3>gl_PointSize → gl_PointCoord 的直接关系</h3>
        <div class="code-example">
            // 顶点着色器
            void main() {
            gl_Position = vec4(100.0, 100.0, 0.0, 1.0); // 点在屏幕坐标(100,100)
            gl_PointSize = 30.0; // 设置点大小为30像素
            // 这直接决定了以(100,100)为中心，30x30像素的点区域
            }

            // 片元着色器
            void main() {
            // gl_PointCoord 是由 gl_PointSize 直接决定的！
            // 对于30x30像素的点，gl_PointCoord 的值范围是 (0,0) 到 (1,1)
            // (0,0) 对应点的左下角，(1,1) 对应点的右上角

            vec2 coord = gl_PointCoord; // 直接来自 gl_PointSize 的设置
            // 可以用来创建各种点形状
            if (length(coord - vec2(0.5)) > 0.5) discard; // 圆形点
            gl_FragColor = vec4(coord, 0.0, 1.0); // 渐变色点
            }
        </div>

        <div class="correction-note">
            <h2>关键修正点</h2>
            <p><strong>正确理解：</strong><code>gl_PointCoord</code> 是由 <code>gl_PointSize</code>
                <strong>直接决定</strong>的，不是独立生成的。</p>
            <ul>
                <li>当顶点着色器设置 <code>gl_PointSize = 30.0</code> 时</li>
                <li>渲染管线就在该点位置创建一个 30×30 像素的区域</li>
                <li>在这个区域内，<code>gl_PointCoord</code> 从 (0,0) 渐变到 (1,1)</li>
            </ul>
        </div>

        <h2>完整的关系总结</h2>

        <table class="correspondence-table">
            <thead>
                <tr>
                    <th>关系类型</th>
                    <th>顶点变量</th>
                    <th>片元变量</th>
                    <th>工作机制</th>
                </tr>
            </thead>
            <tbody>
                <tr class="direct">
                    <td>直接决定</td>
                    <td><code>gl_PointSize</code></td>
                    <td><code>gl_PointCoord</code></td>
                    <td>点大小直接决定点精灵坐标系统</td>
                </tr>
                <tr class="indirect">
                    <td>间接影响</td>
                    <td><code>gl_Position</code></td>
                    <td><code>gl_FragCoord</code>, <code>gl_FrontFacing</code></td>
                    <td>位置影响片元生成和面朝向判断</td>
                </tr>
                <tr class="indirect">
                    <td>插值传递</td>
                    <td>varying 输出</td>
                    <td>varying 输入</td>
                    <td>顶点数据在图元内线性插值</td>
                </tr>
                <tr class="generated">
                    <td>独立生成</td>
                    <td>无</td>
                    <td><code>gl_FragCoord</code></td>
                    <td>根据像素位置自动生成窗口坐标</td>
                </tr>
                <tr class="generated">
                    <td>计算生成</td>
                    <td><code>gl_Position</code> (多顶点)</td>
                    <td><code>gl_FrontFacing</code></td>
                    <td>根据顶点顺序计算面朝向</td>
                </tr>
            </tbody>
        </table>

        <div class="important">
            <h2>最终确认</h2>
            <p>您的理解是<strong>完全正确的</strong>：<code>gl_PointCoord</code> 不是独立生成的，而是由 <code>gl_PointSize</code> 直接决定的。</p>
            <p>感谢您的纠正，这帮助我提供了更准确的技术信息。</p>
        </div>
    </div>
</body>

</html>